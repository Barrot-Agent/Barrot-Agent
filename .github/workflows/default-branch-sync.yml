name: Default Branch Sync

# This workflow helps synchronize the new 'main' branch with the old 'Main' branch
# during the transition period. Remove this workflow after migration is complete.

on:
  workflow_dispatch:  # Manual trigger only
  push:
    branches:
      - Main  # Trigger when Main branch is updated

permissions:
  contents: write

jobs:
  sync-branches:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/Main'
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11  # v4.1.1
        with:
          fetch-depth: 0  # Fetch all history for all branches
          
      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
      - name: Sync Main to main
        run: |
          # Check if main branch exists
          if git ls-remote --heads origin main | grep -q main; then
            echo "✅ main branch exists, syncing changes..."
            git checkout Main
            git pull origin Main
            
            # Merge Main into main
            git checkout main || git checkout -b main
            git merge Main --no-edit -m "Sync: Merge changes from Main to main"
            git push origin main
            
            echo "✅ Successfully synced Main -> main"
          else
            echo "⚠️ main branch doesn't exist yet, creating it..."
            git checkout Main
            git checkout -b main
            git push origin main
            echo "✅ Created main branch from Main"
          fi
          
      - name: Summary
        run: |
          echo "## Branch Sync Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "✅ Synchronized 'Main' branch to 'main' branch" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Next Steps:" >> $GITHUB_STEP_SUMMARY
          echo "1. Change default branch to 'main' in repository settings" >> $GITHUB_STEP_SUMMARY
          echo "2. Update branch protection rules" >> $GITHUB_STEP_SUMMARY
          echo "3. Notify contributors about the change" >> $GITHUB_STEP_SUMMARY
          echo "4. After migration, remove this workflow" >> $GITHUB_STEP_SUMMARY
